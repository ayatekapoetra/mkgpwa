# Environment Configuration

## ğŸ“ File Structure

```
nextjs/
â”œâ”€â”€ .env                  # Main environment file (used by all environments)
â”œâ”€â”€ .env.example          # Template file (commit to git)
â””â”€â”€ .env.backup/          # Old env files backup
    â”œâ”€â”€ .env.local
    â”œâ”€â”€ .env.development
    â”œâ”€â”€ .env.production
    â””â”€â”€ .env.electron
```

## ğŸš€ Quick Start

### 1. First Time Setup

```bash
# Copy template
cp .env.example .env

# Edit dengan nilai yang sesuai
nano .env  # atau editor favorit Anda
```

### 2. Run Development

```bash
npm run dev
# Otomatis load dari .env
# NEXTAUTH_URL akan tetap http://localhost:3005
```

### 3. Build Production

```bash
npm run build
npm start
# Otomatis load dari .env
# Set NEXTAUTH_URL ke production URL via environment variable
```

### 4. Build Electron

```bash
ELECTRON_BUILD=true npm run build:electron
# Otomatis load dari .env + ELECTRON_BUILD flag
```

## ğŸ”§ Environment Variables

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `NEXT_APP_API_URL` | Backend API URL | `https://apimkglocal.makkuragatama.id` |
| `NEXTAUTH_SECRET` | NextAuth secret key | Generate with `openssl rand -base64 32` |
| `NEXTAUTH_URL` | App URL | Dev: `http://localhost:3005`, Prod: `https://pwa.makkuragatama.id` |

### Optional Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `REACT_APP_GOOGLE_MAPS_API_KEY` | Google Maps API | - |
| `OCR_SPACE_API_KEY` | OCR service key | - |
| `AWS_ACCESS_KEY_ID` | AWS S3 access | - |
| `AWS_SECRET_ACCESS_KEY` | AWS S3 secret | - |
| `NODE_ENV` | Node environment | `development` |

## ğŸŒ Environment-Specific Configuration

### Development Mode

```bash
# .env file
NODE_ENV=development
NEXTAUTH_URL=http://localhost:3005
NEXT_APP_API_URL=https://apimkglocal.makkuragatama.id
```

```bash
npm run dev
```

### Production Mode

**Option 1: Override via Environment Variable**
```bash
NEXTAUTH_URL=https://pwa.makkuragatama.id npm run build
NEXTAUTH_URL=https://pwa.makkuragatama.id npm start
```

**Option 2: Update .env file**
```bash
# Edit .env
NEXTAUTH_URL=https://pwa.makkuragatama.id
NODE_ENV=production
```

```bash
npm run build
npm start
```

### Electron Desktop

```bash
ELECTRON_BUILD=true npm run build:electron
```

## ğŸ”’ Security Best Practices

### âœ… DO:
- Keep `.env` in `.gitignore`
- Use `.env.example` as template (commit to git)
- Use different secrets for dev/prod
- Rotate secrets regularly
- Use environment variables in CI/CD

### âŒ DON'T:
- Commit `.env` to git
- Share secrets in public repos
- Use production secrets in development
- Hardcode secrets in code

## ğŸ“ Migration from Old Structure

Old structure (multiple env files):
```
.env.local          â†’ Development
.env.development    â†’ Development 
.env.production     â†’ Production
.env.electron       â†’ Electron build
```

New structure (single env file):
```
.env                â†’ All environments (with fallbacks in next.config.js)
```

**Benefits:**
- âœ… Simpler configuration
- âœ… Single source of truth
- âœ… Easier to maintain
- âœ… Less confusion
- âœ… Environment-specific overrides via CLI or hosting platform

## ğŸ”„ Deployment

### Vercel Deployment

```bash
# Vercel akan otomatis detect .env
# Atau set via Vercel Dashboard:
# Settings â†’ Environment Variables
```

### Docker Deployment

```dockerfile
# Dockerfile
ARG NEXTAUTH_URL
ARG NEXT_APP_API_URL

ENV NEXTAUTH_URL=$NEXTAUTH_URL
ENV NEXT_APP_API_URL=$NEXT_APP_API_URL
```

```bash
docker build --build-arg NEXTAUTH_URL=https://pwa.makkuragatama.id .
```

### Self-Hosted (PM2)

```bash
# ecosystem.config.js
module.exports = {
  apps: [{
    name: 'mkgweb',
    script: 'npm',
    args: 'start',
    env: {
      NODE_ENV: 'production',
      NEXTAUTH_URL: 'https://pwa.makkuragatama.id'
    }
  }]
}
```

## ğŸ†˜ Troubleshooting

### Issue: "NEXTAUTH_SECRET is not defined"

**Solution:**
```bash
# Generate new secret
openssl rand -base64 32

# Add to .env
NEXTAUTH_SECRET=<generated-secret>
```

### Issue: "Cannot connect to API"

**Solution:**
```bash
# Check .env
NEXT_APP_API_URL=https://apimkglocal.makkuragatama.id

# Restart server
npm run dev
```

### Issue: "Different env in production"

**Solution:**
```bash
# Override via environment variable
NEXTAUTH_URL=https://pwa.makkuragatama.id npm run build
NEXTAUTH_URL=https://pwa.makkuragatama.id npm start
```

## ğŸ“š References

- [Next.js Environment Variables](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)
- [NextAuth.js Configuration](https://next-auth.js.org/configuration/options)
- [Vercel Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables)
